<div id="wrapper">
	<div id="header">
        <h1>Add Tag</h1>
        <a href="<%= root_url %>" class="back"><img src="/images/back.png" alt="Back" /></a>
    </div><!--close header-->
    <div id="content">
    	<div id="interior">
			<%= form_for(@tag, :html => {:name=>"edit_tag", :multipart => true} ) do |f| %>
				<% if @tag.errors.any? %>
    				<div id="error_explanation">
      					<h2><%= pluralize(@tag.errors.count, "error") %> prohibited this tag from being saved:</h2>
					    <ul>
      						<% @tag.errors.full_messages.each do |msg| %>
        						<li><%= msg %></li>
      						<% end %>
				        </ul>
    				</div>
  				<% end %>
				<fieldset>
					<ul class="pageitem">
						<li class="bigfield">
							<%= f.text_field :title, :autocomplete=> :off, :placeholder => "Title" %>
						</li>
						<div id="counter"></div>
					</ul>
					
					<ul class="pageitem">
			            <li class="textbox">
							<%= f.text_area :notes, :placeholder => "Notes", :rows => "4" %>
						</li>
					</ul>
					<ul class="pageitem">
			            <li class="checkbox"><span class="name">Location</span>
							<!--<input name="location" type="checkbox" />-->
							<%= f.check_box :location %>
						</li>
					</ul>
				
					<ul class="pageitem" id="file_field">
			            <li>
							<%= f.file_field :image %>
						</li>
					</ul>
					<ul class="pageitem">
						<li class="button">
							<%= f.submit :class => "orange", :value => "TAG IT!" %>
						</li>
					</ul>
					<div id="user_id">
    					<%= f.text_field :user_id, :value=> current_user.id %>
  					</div>
					<div id="time">
    					
						<% time = Time.now.utc.to_i
			     			location = "holder"
						%>
					    <%= f.text_field :time, :value=> time %>
  					</div>
				</fieldset>
		        
			<% end %>
        </div><!--close interior-->
    </div><!--close content-->
    <div id="footer">
    	<p>&copy; copyright 2012 Tag Lab</p>
    </div><!--close footer-->
</div><!--close wrapper-->
<!--
<a onclick="update_fields('Breakfast')">Breakfast</a>
<a onclick="update_fields('Lunch')">Lunch</a>
<a onclick="update_fields('Dinner')">Dinner</a>
<a onclick="update_fields('Bedtime')">Bedtime</a>
<a onclick="update_fields('Wake Up')">Wake Up</a>
-->

<script>  

	$(document).ready(function()
	{
		var max_length = 30;
		// get current number of characters
		$('#counter').html(max_length - $('#tag_title').val().length);

		$('#tag_title').keyup(function()
		{
			// get new length of characters
			if ($(this).val().length >= max_length)
			{
				$('#counter').html('You have reached the maximum limit of ' + max_length);
				$(this).val($(this).val().substr(0, max_length));
			}
			else 
			{
				$('#counter').html(max_length - $(this).val().length);
			}
		});
	});
	
	function initialize(){
		return true;
	}
					
	var agent=navigator.userAgent.toLowerCase();
	var is_iphone = (agent.indexOf('iphone')!=-1);
	var is_ipad = (agent.indexOf('ipad')!=-1);
	if (is_iphone || is_ipad) { 
		//If browser is either on iPhone or iPad, don't show image upload
		$('#file_field').hide();
	}	
	function update_fields(quick_tag) {
		document.forms["new_tag"]["tag_title"].value = quick_tag;
		document.forms["new_tag"].submit();
	}
	
	function showMap(position) {
      		// Show a map centered at (position.coords.latitude, position.coords.longitude).
			document.edit_tag.tag_location.value = position.coords.latitude+","+position.coords.longitude;
	}
	
	// One-shot position request.
    navigator.geolocation.getCurrentPosition(showMap);
	
	$(function() {
				
		var available_titles = [
				<% Tag.all.each do |tag| %>
						"<%= tag.title %>"
					<% if tag != Tag.last %>,<%end%>
				<% end %>
		];
		
		$("#tag_title").autocomplete({
			source: available_titles
		});
			
	});
				
</script>